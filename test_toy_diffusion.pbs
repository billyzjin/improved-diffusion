#!/bin/bash -l
#PBS -A Brownian_bandits
#PBS -l select=1:system=polaris
#PBS -l walltime=0:15:00
#PBS -l filesystems=home:eagle
#PBS -q debug
#PBS -N toy_diffusion

echo "=========================================="
echo "TOY DIFFUSION MODEL TEST"
echo "=========================================="

# Load Python module
module load python

# Create a simple Python test
cat > test_diffusion.py << 'PYEOF'
import torch
import numpy as np
import time

print("Testing basic PyTorch functionality...")
print(f"PyTorch version: {torch.__version__}")
print(f"CUDA available: {torch.cuda.is_available()}")

if torch.cuda.is_available():
    print(f"CUDA device count: {torch.cuda.device_count()}")
    print(f"Current CUDA device: {torch.cuda.current_device()}")
    print(f"CUDA device name: {torch.cuda.get_device_name(0)}")

# Simple tensor operations
x = torch.randn(1000, 1000)
if torch.cuda.is_available():
    x = x.cuda()
    
start_time = time.time()
y = torch.matmul(x, x)
end_time = time.time()

print(f"Matrix multiplication time: {end_time - start_time:.4f} seconds")
print("Basic PyTorch test completed successfully!")
PYEOF

# Run the test
python3 test_diffusion.py

echo "=========================================="
echo "TOY DIFFUSION TEST COMPLETED!"
echo "=========================================="
